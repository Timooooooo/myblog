<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>腾讯大王卡靓号查询</title>
    <div id="myDiv">
        <h3>获取靓号小程序</h3>
        <p>黑色号码为关键字查询结果，红色号码为靓号规则查询结果</p>
    </div>
    <div>
        <input id="r1" type="radio" value="0" name="chose" checked >大王卡</input>
        <input id="r2" type="radio" value="1" name="chose">天王卡</input>
    </div>
    <div>
        <p style="display:inline"><input id = "AAA" type="checkbox" name="rule" checked="checked" />AAA</p>
        <p style="display:inline"><input id = "ABCD" type="checkbox" name="rule" checked="checked" />ABCD</p>
        <p style="display:inline"><input id = "ABC" type="checkbox" name="rule" checked="checked" />ABC</p>
    </div>
    <div >
        <p style="display:inline"><input id = "ABBA" type="checkbox" name="rule" checked="checked" />ABBA</p>
        <p style="display:inline"><input id = "ABAB" type="checkbox" name="rule" checked="checked" />ABAB</p>
        <p style="display:inline"><input id = "AABB" type="checkbox" name="rule" checked="checked" />AABB</p>
    </div>
    <div>
        <p style="display:inline"><input id = "ABCDEF" type="checkbox" name="rule" checked="checked" />ABCDEF</p>
        <p style="display:inline"><input id = "ABCxxABC" type="checkbox" name="rule" checked="checked" />ABCxxABC</p>
        <p style="display:inline"><input id = "ABCAB" type="checkbox" name="rule" checked="checked" />ABCAB</p>
    </div>
    <div>
        <p style="display:inline"><input id = "ABCDABCD" type="checkbox" name="rule" checked="checked" />ABCDABCD</p>
        <p style="display:inline"><input id = "ABxxABxx" type="checkbox" name="rule" checked="checked" />ABxxABxx</p>
        <p style="display:inline"><input id = "xxABxxAB" type="checkbox" name="rule" checked="checked" />xxABxxAB</p>
    </div>
    <div>
        <input id="keywords"></input>
        <button type="button" onclick="loadAjax(1)">获取靓号（10次）</button>
        <button type="button" onclick="loadAjax(2)">自动搜索（搜到即停）</button>
        <button type="button" onclick="loadAjax(3)">无限搜索（永不停息）</button>
    </div>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript">
        function loadAjax(e) {
            $('#phonelist').html("");
            $('#lianghao').html("");
            $('#message').html("");
            var keywords = $('#keywords').val();
            var groupKey = 60236866;
            if($('input:radio:checked').val() == 1){
                groupKey = 32258900;
            }
            var count = 0 ;
            var time = 1 ;
            getPhone(e,keywords,groupKey,count,time);
        }
        function getPhone(e,keywords,groupKey,count,time) {
            $.ajax({
                url:'https://m.10010.com/NumApp/NumberCenter/qryNum?provinceCode=36&cityCode=360&monthFeeLimit=0&groupKey='+groupKey+'&searchCategory=3&net=02&amounts=200000&codeTypeCode&searchValue&qryType=02&goodsNet=2',
                type:'GET', //GET
                async:true,    //或false,是否异步
                timeout:5000,    //超时时间
                dataType:'jsonp',    //返回的数据格式：json/xml/html/script/jsonp/text
                beforeSend:function(xhr){
//                    $('#message').html("第"+e+"次查询中……已累计查询"+Number(count)+"个手机号");
                },
                success:function(data,textStatus,jqXHR){
                    for(let i=0;i<data.numArray.length;i++ ){
                        if(data.numArray[i].toString().length == 11){
                            count = Number(count) + 1 ;
                            $('#message').html("第"+time+"次查询中……已累计查询"+Number(count)+"个手机号");
                            if(data.numArray[i].toString().substring(3,7).indexOf(keywords) != -1 || data.numArray[i].toString().substring(7,12).indexOf(keywords) != -1){
                                $('#phonelist').append(data.numArray[i]+"<br/>");
                                if( e == 2){
                                    $('#message').html("搜索完毕！累计完成"+time+"次查询，累计对比"+Number(count)+"条手机号");
                                    return false ;
                                }

                            }else{
                                var result = isLianghao(data.numArray[i]);
                                if(result){
                                    $('#lianghao').append(result+","+data.numArray[i]+"<br/>");
                                }
                            }
                        }
                    }
//                    console.log($('#phonelist').html(),e);
                    if(e==1 && $('#phonelist').html() =="" && time <10){
                        time++;
                        sleep(3000);
                        getPhone(e,keywords,groupKey,Number(count),time);
                        return false
                    }
                    if(e!==1 && time <9999999){
                        time++;
                        sleep(3000);
                        getPhone(e,keywords,groupKey,Number(count),time);
                        return false
                    }
                    $('#message').html("搜索完毕！累计完成"+time+"次查询，累计对比"+Number(count)+"条手机号");
                },
                error:function(xhr,textStatus){
                    sleep(10000);
                    getPhone(e,keywords,groupKey,Number(count),time);
                },
                complete:function(){
                }
            })
        }

        function isLianghao(tel) {
            var phone = tel.toString();
            var phone1 = tel.toString().substring(3,7) ;
            var phone2 = tel.toString().substring(7,12) ;
            var reg = "";
            if($('#AAA').is(':checked')) {
                reg = new RegExp('(.)\\1{2}', "g");
                if (phone.match(reg) != null) {
                    //AAA
                    return 'AAA';
                }
            }
            if($('#ABCD').is(':checked')){
                reg = new RegExp("(?:0(?=1)|1(?=2)|2(?=3)|3(?=4)|4(?=5)|5(?=6)|6(?=7)|7(?=8)|8(?=9)){3}\\d", "g");
                if (phone1.match(reg) != null || phone2.match(reg) != null) {
                    //ABCD
                    return 'ABCD';
                }
            }
            if($('#ABC').is(':checked')){
                reg = new RegExp("(?:0(?=1)|1(?=2)|2(?=3)|3(?=4)|4(?=5)|5(?=6)|6(?=7)|7(?=8)|8(?=9)){2}\\d", "g");
                if (phone1.match(reg) != null || phone2.match(reg) != null) {
                    //ABC
                    return 'ABC';
                }
            }
            if($('#ABBA').is(':checked')) {
                reg = new RegExp("(\\d)((?!\\1)\\d)\\2[\\d]", "g");
                if (phone1.match(reg) != null) {
                    var result1 = phone1.match(reg).toString();
                    if (result1.substring(0, 1) == result1.substring(3, 4)) {
                        //ABBA
                        return 'ABBA';
                    }
                }
                if (phone2.match(reg) != null) {
                    var result2 = phone2.match(reg).toString();
                    if (result2.substring(0, 1) == result2.substring(3, 4)) {
                        //ABBA
                        return 'ABBA';
                    }
                }
            }
            if($('#ABAB').is(':checked')) {
                reg = new RegExp("(\\d)((?!\\1)\\d)\\1\\2", "g");
                if (phone1.match(reg) != null || phone2.match(reg) != null) {
                    //ABAB
                    return 'ABAB';
                }
            }
            if($('#AABB').is(':checked')) {
                reg = new RegExp("(\\d)\\1((?!\\1)\\d)\\2", "g");
                if (phone1.match(reg) != null || phone2.match(reg) != null) {
                    //AABB
                    return 'AABB';
                }
            }
            if($('#ABCDEF').is(':checked')) {
                reg = new RegExp("(?:0(?=1)|1(?=2)|2(?=3)|3(?=4)|4(?=5)|5(?=6)|6(?=7)|7(?=8)|8(?=9)){5}\\d", "g");
                if (phone.match(reg) != null) {
                    //ABCDEF
                    return 'ABCDEF';
                }
            }
            if($('#ABCxxABC').is(':checked')) {
                reg = new RegExp("^(?:0(?=1)|1(?=2)|2(?=3)|3(?=4)|4(?=5)|5(?=6)|6(?=7)|7(?=8)|8(?=9)){2}\\d[\\d][\\d](?:0(?=1)|1(?=2)|2(?=3)|3(?=4)|4(?=5)|5(?=6)|6(?=7)|7(?=8)|8(?=9)){2}\\d", "g");
                if (phone.match(reg) != null) {
                    var result = phone.match(reg).toString();
                    if (result.substring(0, 3) == result.substring(5,8)) {
                        //ABCxxABC
                        return 'ABCxxABC';
                    }
                }
            }
            if($('#ABCABC').is(':checked')) {
                reg = new RegExp("^(?:0(?=1)|1(?=2)|2(?=3)|3(?=4)|4(?=5)|5(?=6)|6(?=7)|7(?=8)|8(?=9)){2}\\d{4}", "g");
                if (phone.match(reg) != null) {
                    var result = phone.match(reg).toString();
                    if (result.substring(0, 3) == result.substring(3, 6)) {
                        //ABCABC
                        return 'ABCABC';
                    }
                }
            }
            if($('#ABCAB').is(':checked')) {
                reg = new RegExp("(?:0(?=1)|1(?=2)|2(?=3)|3(?=4)|4(?=5)|5(?=6)|6(?=7)|7(?=8)|8(?=9)){2}\\d{3}", "g");
                if (phone.match(reg) != null) {
                    var result = phone.match(reg).toString();
                    if (result.substring(0, 2) == result.substring(3, 5)) {
                        //ABCAB
                        return 'ABCAB';
                    }
                }
            }
            if($('#ABCDABCD').is(':checked')) {
                reg = new RegExp("(?:0(?=1)|1(?=2)|2(?=3)|3(?=4)|4(?=5)|5(?=6)|6(?=7)|7(?=8)|8(?=9)){3}\\d{5}", "g");
                if (phone.match(reg) != null) {
                    var result = phone.match(reg).toString();
                    if (result.substring(0, 4) == result.substring(4, 8)) {
                        //ABCDABCD
                        return 'ABCDABCD';
                    }
                }
            }
            if($('#ABxxABxx').is(':checked')) {
                reg = new RegExp("^(\\d)((?!\\1)\\d)[\\d][\\d](\\d)((?!\\1)\\d)[\\d][\\d]", "g");
                if (phone.match(reg) != null) {
                    var result = phone.match(reg).toString();
                    if (result.substring(0, 2) == result.substring(4, 6)) {
                        //ABxxABxx
                        return 'ABxxABxx';
                    }
                }
            }

            if($('#xxABxxAB').is(':checked')) {
                reg = new RegExp("[\\d][\\d](\\d)((?!\\1)\\d)[\\d][\\d](\\d)((?!\\1)\\d)$", "g");
                if (phone.match(reg) != null) {
                    var result = phone.match(reg).toString();
                    if (result.substring(2, 4) == result.substring(6, 8)) {
                        //ABxxABxx
                        return 'xxABxxAB';
                    }
                }
            }
            return false;

        }
        function sleep(n){
            var start=new Date().getTime();//定义起始时间的毫秒数
            while(true){
                var time=new Date().getTime();//每次执行循环取得一次当前时间的毫秒数
                if(time-start>n){//如果当前时间的毫秒数减去起始时间的毫秒数大于给定的毫秒数，即结束循环
                    break;
                }
            }
        }

    </script>
</head>
<body>
<div id="message" style="color: #af5b00"></div>
<div id="phonelist"></div>
<div id="lianghao" style="color: #af5b00"></div>
</body>
</html>
